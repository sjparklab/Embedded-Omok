임베디드 시스템 과제 : KataGomo 기반 AlphaGo Zero 스타일 인공지능 모델 병합

본 문서는 본 저장소에 포함된 19×19 Gomoku(연속 다섯목) 게임 구현 및 KataGomo 기반 인공지능 통합에 대해 기술한다. 문서는 연구·개발 보고서 형식으로 구성되어 있으며, 시스템 개요, 아키텍처, 주요 파일 설명, 설치 및 실행 지침, 검증 방법, 확장 가능성 및 참고사항을 포함한다.

## 1. 연구 목적 및 개요

본 프로젝트의 목적은 다음과 같다.

1. Gomoku(19×19) 규칙에 따라 동작하는 게임 엔진을 구현한다.
2. KataGomo(= KataGo의 Gomoku용 포크)를 GTP(Go Text Protocol)로 연동하여 인공지능 플레이어를 게임에 통합한다.
3. 인공지능의 제어 및 게임 상태 동기화를 통해 인간-인공지능 대국 환경을 제공한다.

핵심 설계 요소는 책임 분리, GTP를 통한 외부 엔진 통신, 그리고 게임 상태의 일관된 표현이다.

## 2. 시스템 아키텍처

시스템은 다음 세 가지 주요 구성 요소로 이루어진다.

1. 게임 코어: 로컬에서 게임 루프를 관리하고 플레이어(사람 또는 AI) 간의 턴 교환을 담당한다. (`main.py`, `omokgame.py`, `board.py`)
2. 플레이어 인터페이스: 모든 플레이어는 `player` 추상 인터페이스를 통해 동일한 API로 호출된다. AI는 이 인터페이스를 구현하여 엔진과 통신한다. (`player.py`, `stone.py`)
3. 외부 AI 엔진: KataGomo 엔진을 서브프로세스로 실행하고 GTP 명령을 주고받아 다음 수를 요청한다. (`katagomo_ai_player.py`, `gomoku_gtp.cfg`, 모델 파일)

데이터 흐름은 다음과 같다: 게임 코어가 현재 보드 상태를 플레이어에 전달 → AI 플레이어는 GTP로 엔진에 현재 상태/명령을 전송 → 엔진이 `play <coord>` 형식의 응답을 반환 → 게임 코어가 응답 좌표를 적용 → 보드가 갱신되어 다음 턴으로 진행된다.

## 3. 주요 파일 및 역할

다음은 본 저장소의 주요 파일과 각 파일의 역할에 대한 상세 설명이다.

- `main.py`: 애플리케이션 진입점으로, `omokgame` 인스턴스를 생성하고 게임 루프를 실행한다.
- `omokgame.py`: 게임 루프, 턴 관리, 유효성 검사 및 승패/무승부 판정 로직을 포함한다. 플레이어 간 상호 작용을 조율한다.
- `board.py`: 내부 보드 표현(`__game_board`)과 콘솔 출력(좌표 및 기호)을 담당한다. 보드는 정수 값으로 상태를 표현하며(0: 빈칸, 1: 백, -1: 흑), `display()`는 사람이 읽기 쉬운 형식으로 출력한다.
- `player.py`: 플레이어의 기본 인터페이스를 정의한다. 명령형 `next(board, length)` 메서드를 통해 다음 수를 반환하도록 한다.
- `stone.py`: 한 수(돌)의 좌표와 색을 캡슐화하는 도메인 객체로, 게임 로직과 인터페이스 간 데이터 전달 역할을 수행한다.
- `katagomo_ai_player.py`: KataGomo 엔진과의 GTP 통신을 담당하는 AI 래퍼이다. 엔진 프로세스 관리, 표준 에러(stderr) 비동기 수집, `genmove_analyze` 호출 및 응답 파싱을 수행한다. 엔진이 반환하는 최종 `play <coord>` 응답을 파싱하여 보드에 적용한다.
- `gomoku_gtp.cfg`: KataGomo 엔진 동작에 관한 설정(검색 한도, 스레드 수, 로그 설정 등)을 포함한다.
- 모델 파일(`*.bin`, `*.bin.gz`): 신경망 가중치 파일로, 대용량이며 별도의 저장 위치를 권장한다.

## 4. 설치 및 실행 방법

### 사전 요구사항

- Python(3.8 이상 권장) 환경이 필요하다.
- KataGomo 엔진 바이너리와 모델 파일은 로컬에 존재해야 하며, 해당 엔진이 의존하는 라이브러리와 드라이버(CUDA, GPU 드라이버 등)가 올바르게 설치되어 있어야 한다.

### 설치 요약

1. 저장소를 로컬로 클론한다.
2. KataGomo 엔진 바이너리(예: `engine/gom20x_trt.exe`)를 `engine/` 디렉토리에 배치한다.
3. 모델 파일(`*.bin`)을 저장소 루트 또는 엔진이 참조하는 경로에 배치한다.

### 실행 방법

다음 명령으로 게임을 실행한다.

```powershell
python main.py
```

실행 시 콘솔에 보드가 출력되며, 기본 구성으로 AI가 플레이를 수행한다. 엔진-게임 간 GTP 통신 로그는 `gtp_logs/` 디렉토리에 기록된다.

## 5. 검증 및 디버깅 지침

1. 엔진 초기화 로그 확인: KataGomo가 모델을 성공적으로 로드하고 `GTP ready` 상태인지 `gtp_logs/*.log`에서 확인한다.
2. GTP 명령·응답 검증: `genmove_analyze` 호출 시 엔진은 다수의 진단 라인(`INFO`, `Tree` 등)을 출력할 수 있으며, 최종적으로 `play <coord>` 라인을 반환한다. 본 구현의 AI 래퍼는 응답의 다중 라인을 역순으로 조사하여 최종 `play <coord>` 또는 좌표 형태의 토큰을 찾아 적용한다.
3. 좌표 체계 일치: 내부 보드 좌표(0 기반 행·열)와 GTP 좌표(`A`~`T`, `1`~`19`)의 매핑을 검증한다. 본 구현에서는 컬럼 문자 `A`부터 `T`(I 미포함)를 왼쪽에서 오른쪽으로, 행 숫자는 `1`(하단)에서 `19`(상단)으로 매핑한다.
4. 이상 응답 처리: 엔진이 `RESIGN` 또는 계산 중간 상태를 보고하는 경우, AI 래퍼는 `RESIGN`을 단순히 재시도가 아닌 대기 상태로 처리하거나 로그를 남긴 뒤 최종 `play`를 받을 때까지 응답을 관찰하도록 구현되어야 한다. 응답 형식 오류, 범위 벗어남, 이미 점유된 칸 등은 예외로 기록한다.
---